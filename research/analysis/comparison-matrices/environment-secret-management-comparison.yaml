---
comparison_matrix:
  category: "Environment and Secret Management"
  analysis_date: "2025-01-21"
  repositories:
    - "mediawiki-docker-ubc"
    - "sct-docker-images"
    - "WikiDocker"
    - "mmb"
    - "gcpedia"
    - "mediawiki-wbstack"
    - "mw-config"
    - "meza"
    - "docker-mediawiki-chiefy"
    - "mediawiki-manager"

  metrics:
    - name: "12-Factor App Compliance Score"
      description: "Overall compliance with 12-factor app principles (1-10 scale)"
      values:
        mediawiki-docker-ubc: 9
        sct-docker-images: 8
        WikiDocker: 8
        mmb: 8
        gcpedia: 6
        mediawiki-wbstack: 5
        mw-config: 4
        meza: 3
        docker-mediawiki-chiefy: 2
        mediawiki-manager: 6
      analysis: "Wide variation in 12-factor compliance, with container-native solutions scoring highest"

    - name: "Environment Variable Usage"
      description: "Extent of environment variable usage for configuration"
      values:
        mediawiki-docker-ubc: "Comprehensive"
        sct-docker-images: "Comprehensive"
        WikiDocker: "Extensive"
        mmb: "Comprehensive"
        gcpedia: "Basic"
        mediawiki-wbstack: "Mixed"
        mw-config: "Limited"
        meza: "Template-based"
        docker-mediawiki-chiefy: "Minimal"
        mediawiki-manager: "Shell exports"
      analysis: "Container-focused repositories show better environment variable adoption"

    - name: "Secret Management Strategy"
      description: "Approach to handling sensitive configuration data"
      values:
        mediawiki-docker-ubc: "Environment variables with helpers"
        sct-docker-images: "Environment variables"
        WikiDocker: ".env files + environment"
        mmb: "Environment variables"
        gcpedia: "Environment variables"
        mediawiki-wbstack: "Environment variables"
        mw-config: "Private settings files"
        meza: "Ansible variables"
        docker-mediawiki-chiefy: "Hardcoded (anti-pattern)"
        mediawiki-manager: "Shell exports"
      analysis: "Most use environment variables, but hardcoded secrets still present in some repositories"

    - name: "Configuration Externalization"
      description: "Quality of configuration externalization implementation"
      values:
        mediawiki-docker-ubc: "Excellent"
        sct-docker-images: "Good"
        WikiDocker: "Good"
        mmb: "Good"
        gcpedia: "Moderate"
        mediawiki-wbstack: "Basic"
        mw-config: "Complex"
        meza: "Complex"
        docker-mediawiki-chiefy: "Poor"
        mediawiki-manager: "Moderate"
      analysis: "Simple, container-native approaches show better externalization than complex template systems"

    - name: "Default Value Handling"
      description: "Provision of sensible defaults for configuration"
      values:
        mediawiki-docker-ubc: "Comprehensive with fallbacks"
        sct-docker-images: "No defaults"
        WikiDocker: "Basic defaults"
        mmb: "No defaults"
        gcpedia: "Limited defaults"
        mediawiki-wbstack: "Some defaults"
        mw-config: "Complex defaults"
        meza: "Template defaults"
        docker-mediawiki-chiefy: "Hardcoded defaults"
        mediawiki-manager: "Basic defaults"
      analysis: "Only advanced implementations provide comprehensive default handling"

    - name: "Security Practices"
      description: "Implementation of security best practices"
      values:
        mediawiki-docker-ubc: "Good (env vars, validation)"
        sct-docker-images: "Good (comprehensive env vars)"
        WikiDocker: "Good (.env-example)"
        mmb: "Moderate (env vars only)"
        gcpedia: "Moderate (env vars only)"
        mediawiki-wbstack: "Moderate (env vars only)"
        mw-config: "Good (private files)"
        meza: "Moderate (template isolation)"
        docker-mediawiki-chiefy: "Poor (hardcoded secrets)"
        mediawiki-manager: "Moderate (shell exports)"
      analysis: "Security practices vary widely, with some repositories showing critical vulnerabilities"

  patterns:
    common_approaches:
      - "Environment variables for database credentials"
      - "Docker Compose environment sections"
      - "Separate configuration files for different concerns"
      - "Basic .env file usage"

    unique_innovations:
      - "Helper functions for environment loading with defaults (mediawiki-docker-ubc)"
      - "Multi-wiki environment-based selection (meza)"
      - "Comprehensive WG_* prefixed variables (mmb)"
      - "Shell export deployment patterns (mediawiki-manager)"
      - "Ansible template-based configuration (meza)"

    best_practices:
      - "Comprehensive environment variable coverage"
      - "Helper functions with default values"
      - "Modular configuration file organization"
      - "Environment-aware debug configuration"
      - ".env-example files for documentation"
      - "Validation of required environment variables"

    anti_patterns:
      - "Hardcoded secrets in configuration files"
      - "Weak or default passwords in production"
      - "Missing validation for required variables"
      - "Complex template systems without environment awareness"
      - "No separation between public and private configuration"

  recommendations:
    - priority: "high"
      description: "Eliminate hardcoded secrets across all deployments"
      implementation_effort: "low"
      impact: "high"
      affected_repositories: ["docker-mediawiki-chiefy"]

    - priority: "high"
      description: "Implement comprehensive environment variable coverage"
      implementation_effort: "medium"
      impact: "high"
      affected_repositories: ["meza", "docker-mediawiki-chiefy", "mw-config"]

    - priority: "medium"
      description: "Add helper functions for environment variable loading"
      implementation_effort: "low"
      impact: "medium"
      affected_repositories: ["WikiDocker", "mmb", "gcpedia"]

    - priority: "medium"
      description: "Implement Docker secrets for production deployments"
      implementation_effort: "medium"
      impact: "medium"
      affected_repositories: ["all"]

    - priority: "low"
      description: "Add configuration validation and health checks"
      implementation_effort: "medium"
      impact: "medium"
      affected_repositories: ["all"]

  security_assessment:
    critical_issues:
      - repository: "docker-mediawiki-chiefy"
        issue: "Hardcoded database passwords and secret keys"
        risk_level: "critical"
        remediation: "Move all secrets to environment variables"

    moderate_issues:
      - repository: "meza"
        issue: "Complex template system may expose secrets in logs"
        risk_level: "moderate"
        remediation: "Implement proper secret handling in templates"

      - repository: "mediawiki-manager"
        issue: "Shell export files may be readable by other users"
        risk_level: "moderate"
        remediation: "Use proper file permissions and Docker secrets"

    best_security_practices:
      - repository: "mediawiki-docker-ubc"
        practice: "Environment variable helpers with validation"
      - repository: "WikiDocker"
        practice: ".env-example pattern prevents secret exposure"
      - repository: "mw-config"
        practice: "Separate private settings file"

  implementation_complexity:
    simple:
      - "Environment variable adoption"
      - "Basic .env file usage"
      - "Hardcoded secret elimination"

    moderate:
      - "Helper function implementation"
      - "Configuration validation"
      - "Docker secrets adoption"

    complex:
      - "Multi-wiki environment configuration"
      - "Template system migration"
      - "Infrastructure as Code integration"

  migration_strategy:
    phase_1:
      - "Audit and eliminate hardcoded secrets"
      - "Implement basic environment variable usage"
      - "Create .env-example files"

    phase_2:
      - "Add helper functions for environment loading"
      - "Implement configuration validation"
      - "Standardize variable naming conventions"

    phase_3:
      - "Adopt Docker secrets for production"
      - "Implement automated configuration deployment"
      - "Add comprehensive health checks"